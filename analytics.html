<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åˆ†æ - çµå¢ƒç®¡ç†åå°</title>  
    <link rel="stylesheet" href="common.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="admin-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon"></div>
                    <div>
                        <div class="sidebar-logo-text">çµå¢ƒç®¡ç†</div>
                        <div class="sidebar-logo-sub">Admin Console</div>
                    </div>
                </div>
            </div>
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">ä¸»è¦åŠŸèƒ½</div>
                    <a href="dashboard.html" class="nav-item">
                        <span class="nav-item-icon">ğŸ“Š</span>
                        <span class="nav-item-text">æ•°æ®çœ‹æ¿</span>
                    </a>
                    <a href="users.html" class="nav-item">
                        <span class="nav-item-icon">ğŸ‘¥</span>
                        <span class="nav-item-text">ç”¨æˆ·ç®¡ç†</span>
                    </a>
                    <a href="analytics.html" class="nav-item active">
                        <span class="nav-item-icon">ğŸ“ˆ</span>
                        <span class="nav-item-text">æ•°æ®åˆ†æ</span>
                    </a>
                    <a href="membership.html" class="nav-item">
                        <span class="nav-item-icon">ğŸ’</span>
                        <span class="nav-item-text">ä¼šå‘˜åˆ†æ</span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">ç³»ç»Ÿç®¡ç†</div>
                    <a href="security.html" class="nav-item">
                        <span class="nav-item-icon">ğŸ”’</span>
                        <span class="nav-item-text">å®‰å…¨ç®¡ç†</span>
                    </a>
                    <a href="settings.html" class="nav-item">
                        <span class="nav-item-icon">âš™ï¸</span>
                        <span class="nav-item-text">ç³»ç»Ÿè®¾ç½®</span>
                    </a>
                    <a href="login.html" class="nav-item">
                        <span class="nav-item-icon">ğŸšª</span>
                        <span class="nav-item-text">é€€å‡ºç™»å½•</span>
                    </a>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div>
                    <h1 class="header-title">æ•°æ®åˆ†æ</h1>
                    <p class="header-subtitle">å¹³å°åŠŸèƒ½ä½¿ç”¨æ•°æ®ä¸ç”¨æˆ·è¡Œä¸ºåˆ†æ</p>
                </div>
                <div class="header-actions">
                    <div class="date-range">
                        <select class="form-select">
                            <option value="7">æœ€è¿‘7å¤©</option>
                            <option value="30" selected>æœ€è¿‘30å¤©</option>
                            <option value="90">æœ€è¿‘90å¤©</option>
                        </select>
                    </div>
                    <button class="btn btn-secondary" onclick="exportData()">
                        <span>ğŸ“¥</span>
                        <span>å¯¼å‡ºæŠ¥è¡¨</span>
                    </button>
                </div>
            </header>

            <div class="stats-grid" style="margin-bottom: var(--spacing-lg);">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon users">ğŸ‘ï¸</div>
                        <span class="stat-trend up">â†‘ 15.3%</span>
                    </div>
                    <div class="stat-value">1,234,567</div>
                    <div class="stat-label">æ€»è®¿é—®é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon revenue">ğŸ”¥</div>
                        <span class="stat-trend up">â†‘ 8.7%</span>
                    </div>
                    <div class="stat-value">45,892</div>
                    <div class="stat-label">æ—¥æ´»è·ƒç”¨æˆ·</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon active">â±ï¸</div>
                        <span class="stat-trend up">â†‘ 12.2%</span>
                    </div>
                    <div class="stat-value">8.5åˆ†é’Ÿ</div>
                    <div class="stat-label">å¹³å‡ä½¿ç”¨æ—¶é•¿</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon conversion">ğŸ“Š</div>
                        <span class="stat-trend down">â†“ 1.2%</span>
                    </div>
                    <div class="stat-value">23.4%</div>
                    <div class="stat-label">æ¬¡æ—¥ç•™å­˜ç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon users">âœ…</div>
                        <span class="stat-trend up">â†‘ 3.5%</span>
                    </div>
                    <div class="stat-value">89.2%</div>
                    <div class="stat-label">åŠŸèƒ½å®Œæˆç‡</div>
                </div>
            </div>

            <div class="card" style="margin-bottom: var(--spacing-lg);">
                <div class="card-header">
                    <h3 class="card-title">åŠŸèƒ½ä½¿ç”¨çƒ­åŠ›å›¾</h3>
                    <div class="card-subtitle">å„æ ¸å¿ƒæ¨¡å—æ¯æ—¥ä½¿ç”¨é¢‘ç‡åˆ†å¸ƒ</div>
                </div>
                <div class="card-body">
                    <div class="heatmap-container">
                        <div class="heatmap-grid" id="heatmapGrid"></div>
                        <div class="heatmap-legend">
                            <span>ä½</span>
                            <div class="heatmap-legend-cell" style="background: var(--bg-tertiary);"></div>
                            <div class="heatmap-legend-cell" style="background: rgba(102, 126, 234, 0.25);"></div>
                            <div class="heatmap-legend-cell" style="background: rgba(102, 126, 234, 0.5);"></div>
                            <div class="heatmap-legend-cell" style="background: rgba(102, 126, 234, 0.75);"></div>
                            <div class="heatmap-legend-cell" style="background: var(--primary-color);"></div>
                            <span>é«˜</span>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">åŠŸèƒ½ä½¿ç”¨è¶‹åŠ¿</h3>
                        <div class="card-subtitle">å„æ ¸å¿ƒæ¨¡å—ä½¿ç”¨æ¬¡æ•°</div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="usageTrendChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ç”¨æˆ·æ´»è·ƒåº¦åˆ†å¸ƒ</h3>
                        <div class="card-subtitle">ä¸åŒæ´»è·ƒç¨‹åº¦ç”¨æˆ·å æ¯”</div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="activityDistChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-bottom: var(--spacing-lg);">
                <div class="card-header">
                    <h3 class="card-title">å†…å®¹ç”Ÿæ€åˆ†æ</h3>
                    <div class="card-subtitle">ç¤¾åŒºå¸–å­ä¸äº’åŠ¨è¶‹åŠ¿</div>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: var(--border-radius-md);">
                            <div style="font-size: 24px; font-weight: 600; color: var(--text-primary);">2,847</div>
                            <div style="font-size: 13px; color: var(--text-secondary);">ä»Šæ—¥å‘å¸–é‡</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: var(--border-radius-md);">
                            <div style="font-size: 24px; font-weight: 600; color: var(--text-primary);">12,456</div>
                            <div style="font-size: 13px; color: var(--text-secondary);">ä»Šæ—¥äº’åŠ¨é‡</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: var(--border-radius-md);">
                            <div style="font-size: 24px; font-weight: 600; color: var(--text-primary);">89.3%</div>
                            <div style="font-size: 13px; color: var(--text-secondary);">äº’åŠ¨ç‡</div>
                        </div>
                        <div style="text-align: center; padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: var(--border-radius-md);">
                            <div style="font-size: 24px; font-weight: 600; color: var(--text-primary);">4.8</div>
                            <div style="font-size: 13px; color: var(--text-secondary);">å¹³å‡è¯„åˆ†</div>
                        </div>
                    </div>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="contentTrendChart"></canvas>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-lg);">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">çƒ­é—¨è¯é¢˜æ ‡ç­¾</h3>
                        <div class="card-subtitle">ç”¨æˆ·å…³æ³¨åº¦æ’è¡Œ</div>
                    </div>
                    <div class="card-body">
                        <div class="rank-list">
                            <div class="rank-item">
                                <div class="rank-number top1">1</div>
                                <div class="rank-content">
                                    <div class="rank-name">#å¥åº·é¥®é£Ÿ</div>
                                    <div class="rank-meta">12,456 æ¬¡è®¨è®º Â· 89.2ä¸‡ é˜…è¯»</div>
                                </div>
                                <div class="rank-value">+15.3%</div>
                            </div>
                            <div class="rank-item">
                                <div class="rank-number top2">2</div>
                                <div class="rank-content">
                                    <div class="rank-name">#ç¡çœ æ”¹å–„</div>
                                    <div class="rank-meta">10,234 æ¬¡è®¨è®º Â· 76.5ä¸‡ é˜…è¯»</div>
                                </div>
                                <div class="rank-value">+12.8%</div>
                            </div>
                            <div class="rank-item">
                                <div class="rank-number top3">3</div>
                                <div class="rank-content">
                                    <div class="rank-name">#è¿åŠ¨å¥èº«</div>
                                    <div class="rank-meta">9,876 æ¬¡è®¨è®º Â· 65.3ä¸‡ é˜…è¯»</div>
                                </div>
                                <div class="rank-value">+9.4%</div>
                            </div>
                            <div class="rank-item">
                                <div class="rank-number">4</div>
                                <div class="rank-content">
                                    <div class="rank-name">#å¿ƒç†å¥åº·</div>
                                    <div class="rank-meta">8,765 æ¬¡è®¨è®º Â· 54.2ä¸‡ é˜…è¯»</div>
                                </div>
                                <div class="rank-value">+8.1%</div>
                            </div>
                            <div class="rank-item">
                                <div class="rank-number">5</div>
                                <div class="rank-content">
                                    <div class="rank-name">#ä½“è´¨è°ƒç†</div>
                                    <div class="rank-meta">7,654 æ¬¡è®¨è®º Â· 43.1ä¸‡ é˜…è¯»</div>
                                </div>
                                <div class="rank-value">+6.7%</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">AIå¯¹è¯åˆ†æ</h3>
                        <div class="card-subtitle">æ™ºèƒ½åŠ©æ‰‹ä½¿ç”¨æƒ…å†µ</div>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                            <div style="padding: var(--spacing-md); background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-radius: var(--border-radius-md); text-align: center;">
                                <div style="font-size: 28px; font-weight: 600; color: var(--primary-color);">156,789</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">æ€»å¯¹è¯æ¬¡æ•°</div>
                            </div>
                            <div style="padding: var(--spacing-md); background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-radius: var(--border-radius-md); text-align: center;">
                                <div style="font-size: 28px; font-weight: 600; color: var(--primary-color);">8.5åˆ†é’Ÿ</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">å¹³å‡ä¼šè¯æ—¶é•¿</div>
                            </div>
                        </div>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="aiChatChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <style>
        .heatmap-container {
            overflow-x: auto;
        }
        
        .heatmap-grid {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            gap: 4px;
            min-width: 600px;
        }
        
        .heatmap-header {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            text-align: center;
            padding: var(--spacing-sm);
        }
        
        .heatmap-row-label {
            font-size: 13px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            padding-right: var(--spacing-sm);
            font-weight: 500;
        }
        
        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 6px;
            min-height: 40px;
            transition: transform 0.2s ease;
            cursor: pointer;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.1);
        }
        
        .heatmap-cell.level-0 { background: var(--bg-tertiary); }
        .heatmap-cell.level-1 { background: rgba(102, 126, 234, 0.2); }
        .heatmap-cell.level-2 { background: rgba(102, 126, 234, 0.4); }
        .heatmap-cell.level-3 { background: rgba(102, 126, 234, 0.6); }
        .heatmap-cell.level-4 { background: rgba(102, 126, 234, 0.8); }
        .heatmap-cell.level-5 { background: var(--primary-color); }
        
        .heatmap-legend {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 6px;
            margin-top: var(--spacing-md);
            font-size: 12px;
            color: var(--text-tertiary);
        }
        
        .heatmap-legend-cell {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .chart-container {
            position: relative;
            height: 280px;
        }
        
        .rank-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        .rank-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-tertiary);
            border-radius: var(--border-radius-md);
            transition: all var(--transition-normal);
        }
        
        .rank-item:hover {
            background: var(--border-color);
            transform: translateX(4px);
        }
        
        .rank-number {
            width: 32px;
            height: 32px;
            border-radius: var(--border-radius-full);
            background: var(--primary-light);
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .rank-number.top1 {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
        }
        
        .rank-number.top2 {
            background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
            color: white;
        }
        
        .rank-number.top3 {
            background: linear-gradient(135deg, #CD7F32, #8B4513);
            color: white;
        }
        
        .rank-content {
            flex: 1;
        }
        
        .rank-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        
        .rank-meta {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        
        .rank-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--success-color);
        }
    </style>

    <script>
        const modules = ['å‘½ç†åˆ†æ', 'å¥åº·è¯„ä¼°', 'é¥®é£Ÿæ¨è', 'å¥åº·è§„åˆ’'];
        const days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
        
        function generateHeatmapData() {
            const data = [];
            for (let i = 0; i < modules.length; i++) {
                const row = [];
                for (let j = 0; j < 7; j++) {
                    row.push(Math.floor(Math.random() * 6));
                }
                data.push(row);
            }
            return data;
        }
        
        function renderHeatmap() {
            const grid = document.getElementById('heatmapGrid');
            const data = generateHeatmapData();
            
            let html = '<div class="heatmap-header"></div>';
            days.forEach(day => {
                html += `<div class="heatmap-header">${day}</div>`;
            });
            
            for (let i = 0; i < modules.length; i++) {
                html += `<div class="heatmap-row-label">${modules[i]}</div>`;
                for (let j = 0; j < 7; j++) {
                    html += `<div class="heatmap-cell level-${data[i][j]}" title="${modules[i]} - ${days[j]}: ${data[i][j] * 20}%"></div>`;
                }
            }
            
            grid.innerHTML = html;
        }
        
        function initCharts() {
            const usageTrendCtx = document.getElementById('usageTrendChart');
            if (usageTrendCtx) {
                new Chart(usageTrendCtx, {
                    type: 'line',
                    data: {
                        labels: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'],
                        datasets: [
                            {
                                label: 'å‘½ç†åˆ†æ',
                                data: [1200, 1350, 1280, 1420, 1380, 1560, 1490],
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'å¥åº·è¯„ä¼°',
                                data: [980, 1120, 1050, 1180, 1220, 1340, 1280],
                                borderColor: '#764ba2',
                                backgroundColor: 'rgba(118, 75, 162, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'é¥®é£Ÿæ¨è',
                                data: [850, 920, 890, 980, 1050, 1120, 1080],
                                borderColor: '#f093fb',
                                backgroundColor: 'rgba(240, 147, 251, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'å¥åº·è§„åˆ’',
                                data: [650, 720, 780, 820, 890, 950, 920],
                                borderColor: '#48bb78',
                                backgroundColor: 'rgba(72, 187, 120, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
            
            const activityDistCtx = document.getElementById('activityDistChart');
            if (activityDistCtx) {
                new Chart(activityDistCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['é«˜æ´»è·ƒ', 'ä¸­æ´»è·ƒ', 'ä½æ´»è·ƒ', 'æµå¤±ç”¨æˆ·'],
                        datasets: [{
                            data: [25, 35, 28, 12],
                            backgroundColor: [
                                '#667eea',
                                '#48bb78',
                                '#ed8936',
                                '#e2e8f0'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            }
                        },
                        cutout: '65%'
                    }
                });
            }
            
            const contentTrendCtx = document.getElementById('contentTrendChart');
            if (contentTrendCtx) {
                new Chart(contentTrendCtx, {
                    type: 'bar',
                    data: {
                        labels: ['ç¬¬ä¸€å‘¨', 'ç¬¬äºŒå‘¨', 'ç¬¬ä¸‰å‘¨', 'ç¬¬å››å‘¨'],
                        datasets: [
                            {
                                label: 'å‘å¸–é‡',
                                data: [18234, 19876, 21543, 22345],
                                backgroundColor: '#667eea',
                                borderRadius: 8
                            },
                            {
                                label: 'äº’åŠ¨é‡',
                                data: [45678, 52341, 58976, 62345],
                                backgroundColor: '#48bb78',
                                borderRadius: 8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
            
            const aiChatCtx = document.getElementById('aiChatChart');
            if (aiChatCtx) {
                new Chart(aiChatCtx, {
                    type: 'bar',
                    data: {
                        labels: ['å‘½ç†', 'å¥åº·', 'é¥®é£Ÿ', 'è§„åˆ’', 'å…¶ä»–'],
                        datasets: [{
                            label: 'å¯¹è¯æ¬¡æ•°',
                            data: [45678, 38901, 32134, 25678, 12398],
                            backgroundColor: [
                                'rgba(102, 126, 234, 0.8)',
                                'rgba(118, 75, 162, 0.8)',
                                'rgba(240, 147, 251, 0.8)',
                                'rgba(72, 187, 120, 0.8)',
                                'rgba(237, 137, 54, 0.8)'
                            ],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function refreshData() {
            renderHeatmap();
            initCharts();
        }
        
        // å½“å‰é€‰æ‹©çš„æ—¥æœŸèŒƒå›´
        let currentDateRange = 30;
        
        // æ ¹æ®æ—¥æœŸèŒƒå›´ç”Ÿæˆä¸åŒçš„æ•°æ®
        function generateDataByDateRange(range) {
            // åŸºç¡€æ•°æ®
            const baseData = {
                usageTrend: {
                    '7': {
                        labels: ['1æ—¥', '2æ—¥', '3æ—¥', '4æ—¥', '5æ—¥', '6æ—¥', '7æ—¥'],
                        datasets: [
                            { label: 'å‘½ç†åˆ†æ', data: [1200, 1350, 1280, 1420, 1380, 1560, 1490] },
                            { label: 'å¥åº·è¯„ä¼°', data: [980, 1120, 1050, 1180, 1220, 1340, 1280] },
                            { label: 'é¥®é£Ÿæ¨è', data: [850, 920, 890, 980, 1050, 1120, 1080] },
                            { label: 'å¥åº·è§„åˆ’', data: [650, 720, 780, 820, 890, 950, 920] }
                        ]
                    },
                    '30': {
                        labels: ['ç¬¬ä¸€å‘¨', 'ç¬¬äºŒå‘¨', 'ç¬¬ä¸‰å‘¨', 'ç¬¬å››å‘¨'],
                        datasets: [
                            { label: 'å‘½ç†åˆ†æ', data: [8500, 9200, 9800, 10500] },
                            { label: 'å¥åº·è¯„ä¼°', data: [6800, 7500, 8200, 8900] },
                            { label: 'é¥®é£Ÿæ¨è', data: [5200, 5800, 6400, 7100] },
                            { label: 'å¥åº·è§„åˆ’', data: [3800, 4200, 4700, 5300] }
                        ]
                    },
                    '90': {
                        labels: ['ç¬¬1æœˆ', 'ç¬¬2æœˆ', 'ç¬¬3æœˆ'],
                        datasets: [
                            { label: 'å‘½ç†åˆ†æ', data: [32000, 35000, 38000] },
                            { label: 'å¥åº·è¯„ä¼°', data: [25000, 28000, 31000] },
                            { label: 'é¥®é£Ÿæ¨è', data: [18000, 21000, 24000] },
                            { label: 'å¥åº·è§„åˆ’', data: [12000, 15000, 18000] }
                        ]
                    }
                },
                contentTrend: {
                    '7': {
                        labels: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'],
                        datasets: [
                            { label: 'å‘å¸–é‡', data: [1234, 1356, 1456, 1398, 1567, 1789, 1654] },
                            { label: 'äº’åŠ¨é‡', data: [5678, 6789, 7890, 7234, 8765, 9876, 9234] }
                        ]
                    },
                    '30': {
                        labels: ['ç¬¬ä¸€å‘¨', 'ç¬¬äºŒå‘¨', 'ç¬¬ä¸‰å‘¨', 'ç¬¬å››å‘¨'],
                        datasets: [
                            { label: 'å‘å¸–é‡', data: [8234, 8976, 9543, 10345] },
                            { label: 'äº’åŠ¨é‡', data: [45678, 52341, 58976, 62345] }
                        ]
                    },
                    '90': {
                        labels: ['ç¬¬1æœˆ', 'ç¬¬2æœˆ', 'ç¬¬3æœˆ'],
                        datasets: [
                            { label: 'å‘å¸–é‡', data: [32876, 35987, 38765] },
                            { label: 'äº’åŠ¨é‡', data: [185678, 202341, 218976] }
                        ]
                    }
                },
                aiChat: {
                    '7': {
                        labels: ['å‘½ç†', 'å¥åº·', 'é¥®é£Ÿ', 'è§„åˆ’', 'å…¶ä»–'],
                        datasets: [{ data: [12345, 10987, 9876, 8765, 7654] }]
                    },
                    '30': {
                        labels: ['å‘½ç†', 'å¥åº·', 'é¥®é£Ÿ', 'è§„åˆ’', 'å…¶ä»–'],
                        datasets: [{ data: [45678, 38901, 32134, 25678, 19876] }]
                    },
                    '90': {
                        labels: ['å‘½ç†', 'å¥åº·', 'é¥®é£Ÿ', 'è§„åˆ’', 'å…¶ä»–'],
                        datasets: [{ data: [135678, 118901, 98765, 78901, 59876] }]
                    }
                }
            };
            
            return baseData;
        }

        // æ›´æ–°å›¾è¡¨
        function updateCharts() {
            // é”€æ¯æ‰€æœ‰ç°æœ‰å›¾è¡¨
            Chart.helpers.each(Chart.instances, function(instance) {
                instance.destroy();
            });
            
            // é‡æ–°åˆå§‹åŒ–å›¾è¡¨
            initCharts();
        }

        // é‡æ–°åˆå§‹åŒ–å›¾è¡¨å‡½æ•°
        function initCharts() {
            const data = generateDataByDateRange(currentDateRange);
            
            const usageTrendCtx = document.getElementById('usageTrendChart');
            if (usageTrendCtx) {
                new Chart(usageTrendCtx, {
                    type: 'line',
                    data: {
                        labels: data.usageTrend[currentDateRange].labels,
                        datasets: data.usageTrend[currentDateRange].datasets.map(dataset => ({
                            label: dataset.label,
                            data: dataset.data,
                            borderColor: `hsl(${Math.random() * 360}, 70%, 60%)`,
                            backgroundColor: `hsla(${Math.random() * 360}, 70%, 60%, 0.1)`,
                            tension: 0.4,
                            fill: true
                        }))
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            }
            
            const activityDistCtx = document.getElementById('activityDistChart');
            if (activityDistCtx) {
                new Chart(activityDistCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['é«˜æ´»è·ƒ', 'ä¸­æ´»è·ƒ', 'ä½æ´»è·ƒ', 'æµå¤±ç”¨æˆ·'],
                        datasets: [{
                            data: [25, 35, 28, 12],
                            backgroundColor: [
                                '#667eea',
                                '#48bb78',
                                '#ed8936',
                                '#e2e8f0'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        return `${label}: ${value}%`;
                                    }
                                }
                            }
                        },
                        cutout: '65%'
                    }
                });
            }
            
            const contentTrendCtx = document.getElementById('contentTrendChart');
            if (contentTrendCtx) {
                new Chart(contentTrendCtx, {
                    type: 'bar',
                    data: {
                        labels: data.contentTrend[currentDateRange].labels,
                        datasets: data.contentTrend[currentDateRange].datasets.map((dataset, index) => ({
                            label: dataset.label,
                            data: dataset.data,
                            backgroundColor: index === 0 ? '#667eea' : '#48bb78',
                            borderRadius: 8
                        }))
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
            
            const aiChatCtx = document.getElementById('aiChatChart');
            if (aiChatCtx) {
                new Chart(aiChatCtx, {
                    type: 'bar',
                    data: {
                        labels: data.aiChat[currentDateRange].labels,
                        datasets: [{
                            label: 'å¯¹è¯æ¬¡æ•°',
                            data: data.aiChat[currentDateRange].datasets[0].data,
                            backgroundColor: [
                                'rgba(102, 126, 234, 0.8)',
                                'rgba(118, 75, 162, 0.8)',
                                'rgba(240, 147, 251, 0.8)',
                                'rgba(72, 187, 120, 0.8)',
                                'rgba(237, 137, 54, 0.8)'
                            ],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
        }

        // å¯¼å‡ºæ•°æ®åŠŸèƒ½
        function exportData() {
            // æ˜¾ç¤ºå¯¼å‡ºè¿›åº¦
            const exportBtn = event.target;
            const originalText = exportBtn.innerHTML;
            exportBtn.innerHTML = '<span>â³</span><span>å¯¼å‡ºä¸­...</span>';
            exportBtn.disabled = true;
            
            // å‡†å¤‡å¯¼å‡ºæ•°æ®
            const data = generateDataByDateRange(currentDateRange);
            
            // åˆ›å»ºå·¥ä½œç°¿
            const workbook = XLSX.utils.book_new();
            
            // åŠŸèƒ½ä½¿ç”¨è¶‹åŠ¿æ•°æ®
            const usageTrendData = data.usageTrend[currentDateRange];
            const usageTrendSheetData = [
                ['æ—¥æœŸèŒƒå›´', `${currentDateRange}å¤©`],
                [''],
                ['åŠŸèƒ½ä½¿ç”¨è¶‹åŠ¿'],
                ['æ—¥æœŸ', ...usageTrendData.datasets.map(d => d.label)]
            ];
            
            usageTrendData.labels.forEach((label, index) => {
                const row = [label];
                usageTrendData.datasets.forEach(dataset => {
                    row.push(dataset.data[index]);
                });
                usageTrendSheetData.push(row);
            });
            
            const usageTrendSheet = XLSX.utils.aoa_to_sheet(usageTrendSheetData);
            XLSX.utils.book_append_sheet(workbook, usageTrendSheet, 'åŠŸèƒ½ä½¿ç”¨è¶‹åŠ¿');
            
            // å†…å®¹ç”Ÿæ€æ•°æ®
            const contentTrendData = data.contentTrend[currentDateRange];
            const contentTrendSheetData = [
                ['å†…å®¹ç”Ÿæ€åˆ†æ'],
                ['æ—¥æœŸ', ...contentTrendData.datasets.map(d => d.label)]
            ];
            
            contentTrendData.labels.forEach((label, index) => {
                const row = [label];
                contentTrendData.datasets.forEach(dataset => {
                    row.push(dataset.data[index]);
                });
                contentTrendSheetData.push(row);
            });
            
            const contentTrendSheet = XLSX.utils.aoa_to_sheet(contentTrendSheetData);
            XLSX.utils.book_append_sheet(workbook, contentTrendSheet, 'å†…å®¹ç”Ÿæ€åˆ†æ');
            
            // AIå¯¹è¯æ•°æ®
            const aiChatData = data.aiChat[currentDateRange];
            const aiChatSheetData = [
                ['AIå¯¹è¯åˆ†æ'],
                ['ç±»å‹', 'å¯¹è¯æ¬¡æ•°']
            ];
            
            aiChatData.labels.forEach((label, index) => {
                aiChatSheetData.push([label, aiChatData.datasets[0].data[index]]);
            });
            
            const aiChatSheet = XLSX.utils.aoa_to_sheet(aiChatSheetData);
            XLSX.utils.book_append_sheet(workbook, aiChatSheet, 'AIå¯¹è¯åˆ†æ');
            
            // å¯¼å‡ºæ–‡ä»¶
            setTimeout(() => {
                XLSX.writeFile(workbook, `æ•°æ®åˆ†ææŠ¥è¡¨_${currentDateRange}å¤©_${new Date().toISOString().slice(0, 10)}.xlsx`);
                exportBtn.innerHTML = originalText;
                exportBtn.disabled = false;
                alert('æŠ¥è¡¨å¯¼å‡ºæˆåŠŸï¼');
            }, 1000);
        }
        
        // ä¸ºçƒ­åŠ›å›¾å•å…ƒæ ¼æ·»åŠ ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('heatmap-cell')) {
                const title = e.target.getAttribute('title');
                if (title) {
                    alert(title);
                }
            }
        });

        // ä¸ºæ’è¡Œæ¦œé¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', function(e) {
            const rankItem = e.target.closest('.rank-item');
            if (rankItem) {
                const rankName = rankItem.querySelector('.rank-name').textContent;
                alert(`æŸ¥çœ‹è¯é¢˜ ${rankName} çš„è¯¦ç»†æ•°æ®`);
            }
        });

        // æ·»åŠ é¡µé¢åŠ è½½åŠ¨ç”»
        window.addEventListener('load', function() {
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.5s ease';
            setTimeout(function() {
                document.body.style.opacity = '1';
            }, 100);
        });

        // ä¸ºç»Ÿè®¡å¡ç‰‡æ·»åŠ æ‚¬åœæ•ˆæœ
        document.addEventListener('DOMContentLoaded', function() {
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach(card => {
                card.style.transition = 'all var(--transition-normal)';
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px)';
                    this.style.boxShadow = 'var(--shadow-md)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'var(--shadow-sm)';
                });
            });

            renderHeatmap();
            initCharts();
        });

        // æ—¥æœŸèŒƒå›´é€‰æ‹©äº‹ä»¶ç›‘å¬
        document.getElementById('dateRangeSelect').addEventListener('change', function() {
            currentDateRange = this.value;
            refreshData();
        });
    </script>
</body>
</html>
