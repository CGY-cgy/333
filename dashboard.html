<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®çœ‹æ¿ - çµå¢ƒç®¡ç†åå°</title>
    <link rel="stylesheet" href="common.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="admin-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon"></div>
                    <div>
                        <div class="sidebar-logo-text">çµå¢ƒç®¡ç†</div>
                        <div class="sidebar-logo-sub">Admin Console</div>
                    </div>
                </div>
            </div>
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">ä¸»è¦åŠŸèƒ½</div>
                    <a href="dashboard.html" class="nav-item active">
                        <span class="nav-item-icon">ğŸ“Š</span>
                        <span class="nav-item-text">æ•°æ®çœ‹æ¿</span>
                    </a>
                    <a href="users.html" class="nav-item">
                        <span class="nav-item-icon">ğŸ‘¥</span>
                        <span class="nav-item-text">ç”¨æˆ·ç®¡ç†</span>
                    </a>
                    <a href="analytics.html" class="nav-item">
                        <span class="nav-item-icon">ğŸ“ˆ</span>
                        <span class="nav-item-text">æ•°æ®åˆ†æ</span>
                    </a>
                    <a href="membership.html" class="nav-item">
                        <span class="nav-item-icon">ğŸ’</span>
                        <span class="nav-item-text">ä¼šå‘˜åˆ†æ</span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">ç³»ç»Ÿç®¡ç†</div>
                    <a href="security.html" class="nav-item">
                        <span class="nav-item-icon">ğŸ”’</span>
                        <span class="nav-item-text">å®‰å…¨ç®¡ç†</span>
                    </a>
                    <a href="settings.html" class="nav-item">
                        <span class="nav-item-icon">âš™ï¸</span>
                        <span class="nav-item-text">ç³»ç»Ÿè®¾ç½®</span>
                    </a>
                    <a href="login.html" class="nav-item">
                        <span class="nav-item-icon">ğŸšª</span>
                        <span class="nav-item-text">é€€å‡ºç™»å½•</span>
                    </a>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div>
                    <h1 class="header-title">æ•°æ®çœ‹æ¿</h1>
                    <p class="header-subtitle">å®æ—¶ç›‘æ§å¹³å°è¿è¥æ•°æ®ä¸ç”¨æˆ·è¡Œä¸º</p>
                </div>
                <div class="header-actions">
                    <select class="form-select" style="width: auto;" id="dateRangeSelect">
                        <option value="7">æœ€è¿‘7å¤©</option>
                        <option value="30" selected>æœ€è¿‘30å¤©</option>
                        <option value="90">æœ€è¿‘90å¤©</option>
                    </select>
                    <button class="header-btn primary" onclick="exportReport()">
                        <span>ğŸ“¥</span>
                        <span>å¯¼å‡ºæŠ¥è¡¨</span>
                    </button>
                </div>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon users">ğŸ‘¥</div>
                        <span class="stat-trend up">â†‘ 12.5%</span>
                    </div>
                    <div class="stat-value">128,456</div>
                    <div class="stat-label">æ³¨å†Œç”¨æˆ·æ€»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon revenue">ğŸ’°</div>
                        <span class="stat-trend up">â†‘ 8.3%</span>
                    </div>
                    <div class="stat-value">Â¥486,920</div>
                    <div class="stat-label">æœ¬æœˆæ”¶å…¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon active">âš¡</div>
                        <span class="stat-trend up">â†‘ 15.2%</span>
                    </div>
                    <div class="stat-value">45,892</div>
                    <div class="stat-label">æ—¥æ´»è·ƒç”¨æˆ·</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon conversion">ğŸ¯</div>
                        <span class="stat-trend down">â†“ 2.1%</span>
                    </div>
                    <div class="stat-value">23.4%</div>
                    <div class="stat-label">ä¼šå‘˜è½¬åŒ–ç‡</div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);" class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨åˆ†æ</h3>
                        <div style="display: flex; gap: var(--spacing-md);">
                            <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                                <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--primary-color);"></span>
                                <span>æ—¥å‡ä½¿ç”¨æ¬¡æ•°</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="functionUsageChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">åŠŸèƒ½ä½¿ç”¨çƒ­åŠ›å›¾</h3>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: var(--spacing-sm);">è¿‡å»30å¤©å„æ¨¡å—ä½¿ç”¨é¢‘ç‡</div>
                    <div id="heatmap" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px;"></div>
                    <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 11px; color: var(--text-tertiary);">
                        <span>å‘¨ä¸€</span><span>å‘¨äºŒ</span><span>å‘¨ä¸‰</span><span>å‘¨å››</span><span>å‘¨äº”</span><span>å‘¨å…­</span><span>å‘¨æ—¥</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">AIå¯¹è¯ä½¿ç”¨æƒ…å†µ</h3>
                        <div style="display: flex; gap: var(--spacing-md);">
                            <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                                <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--success-color);"></span>
                                <span>å¯¹è¯æ¬¡æ•°</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                                <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--warning-color);"></span>
                                <span>å¹³å‡ä¼šè¯é•¿åº¦</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="aiChatChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">å†…å®¹ç”Ÿæ€åˆ†æ</h3>
                        <div style="display: flex; gap: var(--spacing-md);">
                            <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                                <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--primary-color);"></span>
                                <span>å‘å¸–é‡</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                                <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--success-color);"></span>
                                <span>äº’åŠ¨é‡</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="contentEcosystemChart"></canvas>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--spacing-md);" class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">æœ€æ–°åŠ¨æ€</h3>
                        <a href="#" style="font-size: 13px; color: var(--primary-color); text-decoration: none;">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
                    </div>
                    <div style="max-height: 320px; overflow-y: auto;" id="latestActivities">
                        <div style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md) 0; border-bottom: 1px solid var(--border-color);">
                            <div style="width: 40px; height: 40px; border-radius: var(--border-radius-full); background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; flex-shrink: 0;">æ</div>
                            <div style="flex: 1;">
                                <div style="font-size: 14px; color: var(--text-primary); margin-bottom: 4px;">æ–°ç”¨æˆ· <strong>ææ™“æ˜</strong> æ³¨å†ŒæˆåŠŸ</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">2åˆ†é’Ÿå‰</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md) 0; border-bottom: 1px solid var(--border-color);">
                            <div style="width: 40px; height: 40px; border-radius: var(--border-radius-full); background: var(--success-color); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; flex-shrink: 0;">ç‹</div>
                            <div style="flex: 1;">
                                <div style="font-size: 14px; color: var(--text-primary); margin-bottom: 4px;">ç”¨æˆ· <strong>ç‹èŠ³</strong> å¼€é€šå¹´åº¦ä¼šå‘˜</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">15åˆ†é’Ÿå‰</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md) 0; border-bottom: 1px solid var(--border-color);">
                            <div style="width: 40px; height: 40px; border-radius: var(--border-radius-full); background: var(--warning-color); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; flex-shrink: 0;">å¼ </div>
                            <div style="flex: 1;">
                                <div style="font-size: 14px; color: var(--text-primary); margin-bottom: 4px;">ç”¨æˆ· <strong>å¼ ä¼Ÿ</strong> å®Œæˆå¥åº·é—®å·</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">32åˆ†é’Ÿå‰</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md) 0; border-bottom: 1px solid var(--border-color);">
                            <div style="width: 40px; height: 40px; border-radius: var(--border-radius-full); background: var(--secondary-color); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; flex-shrink: 0;">åˆ˜</div>
                            <div style="flex: 1;">
                                <div style="font-size: 14px; color: var(--text-primary); margin-bottom: 4px;">ç”¨æˆ· <strong>åˆ˜æ´‹</strong> å‘å¸ƒå¥åº·å¿ƒå¾—å¸–å­</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">1å°æ—¶å‰</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md) 0;">
                            <div style="width: 40px; height: 40px; border-radius: var(--border-radius-full); background: var(--danger-color); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; flex-shrink: 0;">é™ˆ</div>
                            <div style="flex: 1;">
                                <div style="font-size: 14px; color: var(--text-primary); margin-bottom: 4px;">ç”¨æˆ· <strong>é™ˆé™</strong> ä½¿ç”¨èˆŒåƒæ£€æµ‹åŠŸèƒ½</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">2å°æ—¶å‰</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">å¿«æ·æ“ä½œ</h3>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                        <button class="btn btn-secondary" style="justify-content: flex-start; padding: var(--spacing-md);" onclick="location.href='users.html'">
                            <span style="width: 40px; height: 40px; border-radius: var(--border-radius-md); background: rgba(102, 126, 234, 0.1); color: var(--primary-color); display: flex; align-items: center; justify-content: center; font-size: 18px;">ğŸ‘¤</span>
                            <div style="text-align: left;">
                                <div style="font-size: 14px; color: var(--text-primary); font-weight: 500;">ç”¨æˆ·ç®¡ç†</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰ç”¨æˆ·</div>
                            </div>
                        </button>
                        <button class="btn btn-secondary" style="justify-content: flex-start; padding: var(--spacing-md);" onclick="location.href='analytics.html'">
                            <span style="width: 40px; height: 40px; border-radius: var(--border-radius-md); background: rgba(72, 187, 120, 0.1); color: var(--success-color); display: flex; align-items: center; justify-content: center; font-size: 18px;">ğŸ“Š</span>
                            <div style="text-align: left;">
                                <div style="font-size: 14px; color: var(--text-primary); font-weight: 500;">æ•°æ®åˆ†æ</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š</div>
                            </div>
                        </button>
                        <button class="btn btn-secondary" style="justify-content: flex-start; padding: var(--spacing-md);" onclick="location.href='security.html'">
                            <span style="width: 40px; height: 40px; border-radius: var(--border-radius-md); background: rgba(237, 137, 54, 0.1); color: var(--warning-color); display: flex; align-items: center; justify-content: center; font-size: 18px;">ğŸ”</span>
                            <div style="text-align: left;">
                                <div style="font-size: 14px; color: var(--text-primary); font-weight: 500;">å®‰å…¨è®¾ç½®</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">ç®¡ç†è´¦æˆ·å®‰å…¨ç­–ç•¥</div>
                            </div>
                        </button>
                        <button class="btn btn-secondary" style="justify-content: flex-start; padding: var(--spacing-md);" onclick="backupData()">
                            <span style="width: 40px; height: 40px; border-radius: var(--border-radius-md); background: rgba(118, 75, 162, 0.1); color: var(--secondary-color); display: flex; align-items: center; justify-content: center; font-size: 18px;">ğŸ’¾</span>
                            <div style="text-align: left;">
                                <div style="font-size: 14px; color: var(--text-primary); font-weight: 500;">æ•°æ®å¤‡ä»½</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">ç«‹å³å¤‡ä»½ç³»ç»Ÿæ•°æ®</div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const chartColors = {
            primary: '#667eea',
            secondary: '#764ba2',
            success: '#48bb78',
            warning: '#ed8936',
            danger: '#f56565',
            purple: '#764ba2'
        };

        function initFunctionUsageChart() {
            const ctx = document.getElementById('functionUsageChart').getContext('2d');
            
            // æ ¹æ®æ—¥æœŸèŒƒå›´ç”Ÿæˆä¸åŒçš„æ•°æ®
            let data;
            if (currentDateRange === 7) {
                data = [5200, 4800, 6500, 3200, 4100, 9800];
            } else if (currentDateRange === 30) {
                data = [12500, 9800, 15600, 7200, 8900, 23400];
            } else {
                data = [32500, 28900, 39800, 21500, 25600, 65400];
            }
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['å‘½ç†åˆ†æ', 'å¥åº·è¯„ä¼°', 'é¥®é£Ÿæ¨è', 'å¥åº·è§„åˆ’', 'èˆŒåƒæ£€æµ‹', 'AIå¯¹è¯'],
                    datasets: [{
                        label: 'æ—¥å‡ä½¿ç”¨æ¬¡æ•°',
                        data: data,
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(72, 187, 120, 0.8)',
                            'rgba(237, 137, 54, 0.8)',
                            'rgba(245, 101, 101, 0.8)',
                            'rgba(118, 75, 162, 0.8)'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function initHeatmap() {
            const heatmapContainer = document.getElementById('heatmap');
            const modules = ['å‘½ç†', 'å¥åº·', 'é¥®é£Ÿ', 'è§„åˆ’', 'AI'];
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            heatmapContainer.innerHTML = '';
            
            // æ ¹æ®æ—¥æœŸèŒƒå›´ç”Ÿæˆä¸åŒæ•°é‡çš„å•å…ƒæ ¼
            const days = currentDateRange;
            
            for (let i = 0; i < days; i++) {
                const cell = document.createElement('div');
                cell.style.aspectRatio = '1';
                cell.style.borderRadius = '4px';
                const level = Math.floor(Math.random() * 5) + 1;
                const opacity = level * 0.2;
                cell.style.background = `rgba(102, 126, 234, ${opacity})`;
                cell.title = `ç¬¬${i + 1}å¤© - ${modules[i % 5]}æ¨¡å—ä½¿ç”¨`;
                heatmapContainer.appendChild(cell);
            }
        }

        function initAIChatChart() {
            const ctx = document.getElementById('aiChatChart').getContext('2d');
            
            // æ ¹æ®æ—¥æœŸèŒƒå›´ç”Ÿæˆä¸åŒçš„æ ‡ç­¾å’Œæ•°æ®
            let labels, chatData, durationData;
            if (currentDateRange === 7) {
                labels = ['1æ—¥', '2æ—¥', '3æ—¥', '4æ—¥', '5æ—¥', '6æ—¥', '7æ—¥'];
                chatData = [1200, 1400, 1350, 1500, 1650, 1800, 1750];
                durationData = [8.2, 9.1, 8.7, 10.2, 9.4, 11.5, 10.8];
            } else if (currentDateRange === 30) {
                labels = ['1æ—¥', '5æ—¥', '10æ—¥', '15æ—¥', '20æ—¥', '25æ—¥', '30æ—¥'];
                chatData = [4200, 4800, 5100, 4900, 5600, 6200, 5800];
                durationData = [8.5, 9.2, 8.8, 10.1, 9.5, 11.2, 10.5];
            } else {
                labels = ['1æ—¥', '15æ—¥', '30æ—¥', '45æ—¥', '60æ—¥', '75æ—¥', '90æ—¥'];
                chatData = [12500, 14200, 15300, 14800, 16700, 18500, 17600];
                durationData = [8.8, 9.5, 9.1, 10.3, 9.8, 11.6, 10.9];
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å¯¹è¯æ¬¡æ•°',
                        data: chatData,
                        borderColor: chartColors.success,
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        fill: true,
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'å¹³å‡ä¼šè¯é•¿åº¦(åˆ†é’Ÿ)',
                        data: durationData,
                        borderColor: chartColors.warning,
                        backgroundColor: 'transparent',
                        borderDash: [5, 5],
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            beginAtZero: true,
                            grid: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function initContentEcosystemChart() {
            const ctx = document.getElementById('contentEcosystemChart').getContext('2d');
            
            // æ ¹æ®æ—¥æœŸèŒƒå›´ç”Ÿæˆä¸åŒçš„æ•°æ®
            let labels, postData, interactionData;
            if (currentDateRange === 7) {
                labels = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
                postData = [156, 189, 234, 198, 267, 312, 289];
                interactionData = [892, 1056, 1234, 1189, 1456, 1876, 1623];
            } else if (currentDateRange === 30) {
                labels = ['ç¬¬1å‘¨', 'ç¬¬2å‘¨', 'ç¬¬3å‘¨', 'ç¬¬4å‘¨', 'ç¬¬5å‘¨'];
                postData = [654, 723, 812, 789, 856];
                interactionData = [3456, 3892, 4234, 4056, 4489];
            } else {
                labels = ['ç¬¬1æœˆ', 'ç¬¬2æœˆ', 'ç¬¬3æœˆ'];
                postData = [2890, 3123, 3456];
                interactionData = [14567, 15892, 16789];
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å‘å¸–é‡',
                        data: postData,
                        borderColor: chartColors.primary,
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'äº’åŠ¨é‡',
                        data: interactionData,
                        borderColor: chartColors.success,
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        let currentDateRange = 30;

        function exportReport() {
            // æ˜¾ç¤ºå¯¼å‡ºè¿›åº¦
            const exportBtn = event.target;
            const originalText = exportBtn.innerHTML;
            exportBtn.innerHTML = '<span>â³</span><span>å¯¼å‡ºä¸­...</span>';
            exportBtn.disabled = true;
            
            // å‡†å¤‡å¯¼å‡ºæ•°æ®
            const reportData = {
                'æ—¥æœŸèŒƒå›´': `${currentDateRange}å¤©`,
                'å¯¼å‡ºæ—¶é—´': new Date().toLocaleString(),
                'æ³¨å†Œç”¨æˆ·æ€»æ•°': '128,456',
                'æœ¬æœˆæ”¶å…¥': 'Â¥486,920',
                'æ—¥æ´»è·ƒç”¨æˆ·': '45,892',
                'ä¼šå‘˜è½¬åŒ–ç‡': '23.4%'
            };
            
            // æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨æ•°æ®
            const functionUsageData = {
                'åŠŸèƒ½': ['å‘½ç†åˆ†æ', 'å¥åº·è¯„ä¼°', 'é¥®é£Ÿæ¨è', 'å¥åº·è§„åˆ’', 'èˆŒåƒæ£€æµ‹', 'AIå¯¹è¯'],
                'æ—¥å‡ä½¿ç”¨æ¬¡æ•°': currentDateRange === 7 ? [5200, 4800, 6500, 3200, 4100, 9800] : 
                                currentDateRange === 30 ? [12500, 9800, 15600, 7200, 8900, 23400] : 
                                [32500, 28900, 39800, 21500, 25600, 65400]
            };
            
            // AIå¯¹è¯ä½¿ç”¨æ•°æ®
            const aiChatData = {
                'æ—¥æœŸ': currentDateRange === 7 ? ['1æ—¥', '2æ—¥', '3æ—¥', '4æ—¥', '5æ—¥', '6æ—¥', '7æ—¥'] : 
                        currentDateRange === 30 ? ['1æ—¥', '5æ—¥', '10æ—¥', '15æ—¥', '20æ—¥', '25æ—¥', '30æ—¥'] : 
                        ['1æ—¥', '15æ—¥', '30æ—¥', '45æ—¥', '60æ—¥', '75æ—¥', '90æ—¥'],
                'å¯¹è¯æ¬¡æ•°': currentDateRange === 7 ? [1200, 1400, 1350, 1500, 1650, 1800, 1750] : 
                            currentDateRange === 30 ? [4200, 4800, 5100, 4900, 5600, 6200, 5800] : 
                            [12500, 14200, 15300, 14800, 16700, 18500, 17600],
                'å¹³å‡ä¼šè¯é•¿åº¦(åˆ†é’Ÿ)': currentDateRange === 7 ? [8.2, 9.1, 8.7, 10.2, 9.4, 11.5, 10.8] : 
                                    currentDateRange === 30 ? [8.5, 9.2, 8.8, 10.1, 9.5, 11.2, 10.5] : 
                                    [8.8, 9.5, 9.1, 10.3, 9.8, 11.6, 10.9]
            };
            
            // å†…å®¹ç”Ÿæ€æ•°æ®
            const contentData = {
                'å‘¨æœŸ': currentDateRange === 7 ? ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'] : 
                        currentDateRange === 30 ? ['ç¬¬1å‘¨', 'ç¬¬2å‘¨', 'ç¬¬3å‘¨', 'ç¬¬4å‘¨', 'ç¬¬5å‘¨'] : 
                        ['ç¬¬1æœˆ', 'ç¬¬2æœˆ', 'ç¬¬3æœˆ'],
                'å‘å¸–é‡': currentDateRange === 7 ? [156, 189, 234, 198, 267, 312, 289] : 
                        currentDateRange === 30 ? [654, 723, 812, 789, 856] : 
                        [2890, 3123, 3456],
                'äº’åŠ¨é‡': currentDateRange === 7 ? [892, 1056, 1234, 1189, 1456, 1876, 1623] : 
                        currentDateRange === 30 ? [3456, 3892, 4234, 4056, 4489] : 
                        [14567, 15892, 16789]
            };
            
            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            
            // æ·»åŠ æ¦‚è§ˆå·¥ä½œè¡¨
            const overviewSheet = XLSX.utils.json_to_sheet([reportData]);
            XLSX.utils.book_append_sheet(wb, overviewSheet, 'æ¦‚è§ˆ');
            
            // æ·»åŠ æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨å·¥ä½œè¡¨
            const functionSheetData = [];
            for (let i = 0; i < functionUsageData.åŠŸèƒ½.length; i++) {
                functionSheetData.push({
                    'åŠŸèƒ½': functionUsageData.åŠŸèƒ½[i],
                    'æ—¥å‡ä½¿ç”¨æ¬¡æ•°': functionUsageData.æ—¥å‡ä½¿ç”¨æ¬¡æ•°[i]
                });
            }
            const functionSheet = XLSX.utils.json_to_sheet(functionSheetData);
            XLSX.utils.book_append_sheet(wb, functionSheet, 'æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨');
            
            // æ·»åŠ AIå¯¹è¯ä½¿ç”¨å·¥ä½œè¡¨
            const aiChatSheetData = [];
            for (let i = 0; i < aiChatData.æ—¥æœŸ.length; i++) {
                aiChatSheetData.push({
                    'æ—¥æœŸ': aiChatData.æ—¥æœŸ[i],
                    'å¯¹è¯æ¬¡æ•°': aiChatData.å¯¹è¯æ¬¡æ•°[i],
                    'å¹³å‡ä¼šè¯é•¿åº¦(åˆ†é’Ÿ)': aiChatData.å¹³å‡ä¼šè¯é•¿åº¦(åˆ†é’Ÿ)[i]
                });
            }
            const aiChatSheet = XLSX.utils.json_to_sheet(aiChatSheetData);
            XLSX.utils.book_append_sheet(wb, aiChatSheet, 'AIå¯¹è¯ä½¿ç”¨');
            
            // æ·»åŠ å†…å®¹ç”Ÿæ€å·¥ä½œè¡¨
            const contentSheetData = [];
            for (let i = 0; i < contentData.å‘¨æœŸ.length; i++) {
                contentSheetData.push({
                    'å‘¨æœŸ': contentData.å‘¨æœŸ[i],
                    'å‘å¸–é‡': contentData.å‘å¸–é‡[i],
                    'äº’åŠ¨é‡': contentData.äº’åŠ¨é‡[i]
                });
            }
            const contentSheet = XLSX.utils.json_to_sheet(contentSheetData);
            XLSX.utils.book_append_sheet(wb, contentSheet, 'å†…å®¹ç”Ÿæ€');
            
            // å¯¼å‡ºæ–‡ä»¶
            setTimeout(() => {
                XLSX.writeFile(wb, `æ•°æ®çœ‹æ¿æŠ¥è¡¨_${currentDateRange}å¤©_${new Date().toISOString().slice(0, 10)}.xlsx`);
                exportBtn.innerHTML = originalText;
                exportBtn.disabled = false;
                alert('æŠ¥è¡¨å¯¼å‡ºæˆåŠŸï¼');
            }, 1000);
        }

        function backupData() {
            // æ˜¾ç¤ºå¤‡ä»½è¿›åº¦å¯¹è¯æ¡†
            const backupBtn = event.target;
            const originalText = backupBtn.innerHTML;
            backupBtn.innerHTML = '<span>â³</span><span>å¤‡ä»½ä¸­...</span>';
            backupBtn.disabled = true;
            
            // æ¨¡æ‹Ÿå¤‡ä»½è¿‡ç¨‹
            setTimeout(() => {
                backupBtn.innerHTML = '<span>âœ…</span><span>å¤‡ä»½å®Œæˆ</span>';
                setTimeout(() => {
                    backupBtn.innerHTML = originalText;
                    backupBtn.disabled = false;
                    alert('æ•°æ®å¤‡ä»½æˆåŠŸï¼');
                }, 1000);
            }, 2000);
        }

        function updateAllCharts(range) {
            currentDateRange = range;
            
            // é‡æ–°åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
            initFunctionUsageChart();
            initHeatmap();
            initAIChatChart();
            initContentEcosystemChart();
        }

        // ç”Ÿæˆéšæœºæ´»åŠ¨æ•°æ®çš„å‡½æ•°
        function generateActivityItem() {
            const users = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ', 'å­™å…«', 'å‘¨ä¹', 'å´å'];
            const actions = [
                'æ³¨å†ŒæˆåŠŸ',
                'å¼€é€šå¹´åº¦ä¼šå‘˜',
                'å®Œæˆå¥åº·é—®å·',
                'å‘å¸ƒå¥åº·å¿ƒå¾—å¸–å­',
                'ä½¿ç”¨èˆŒåƒæ£€æµ‹åŠŸèƒ½',
                'æŸ¥çœ‹å¥åº·æŠ¥å‘Š',
                'åˆ†äº«å¥åº·æ–‡ç« ',
                'é‚€è¯·å¥½å‹æ³¨å†Œ'
            ];
            const user = users[Math.floor(Math.random() * users.length)];
            const action = actions[Math.floor(Math.random() * actions.length)];
            const colors = ['linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%)', 'var(--success-color)', 'var(--warning-color)', 'var(--secondary-color)', 'var(--danger-color)'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            const timeAgo = Math.floor(Math.random() * 120) + 'åˆ†é’Ÿå‰';
            
            return `
                <div style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md) 0; border-bottom: 1px solid var(--border-color);">
                    <div style="width: 40px; height: 40px; border-radius: var(--border-radius-full); background: ${color}; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; flex-shrink: 0;">${user.charAt(0)}</div>
                    <div style="flex: 1;">
                        <div style="font-size: 14px; color: var(--text-primary); margin-bottom: 4px;">ç”¨æˆ· <strong>${user}</strong> ${action}</div>
                        <div style="font-size: 12px; color: var(--text-tertiary);">${timeAgo}</div>
                    </div>
                </div>
            `;
        }

        // åˆå§‹åŒ–æ»šåŠ¨åŠ è½½åŠŸèƒ½
        function initScrollLoad() {
            const activitiesContainer = document.getElementById('latestActivities');
            let isLoading = false;
            
            activitiesContainer.addEventListener('scroll', function() {
                if (isLoading) return;
                
                // å½“æ»šåŠ¨åˆ°è·ç¦»åº•éƒ¨100pxæ—¶åŠ è½½æ›´å¤š
                if (activitiesContainer.scrollTop + activitiesContainer.clientHeight >= activitiesContainer.scrollHeight - 100) {
                    loadMoreActivities();
                }
            });
            
            function loadMoreActivities() {
                isLoading = true;
                
                // æ¨¡æ‹Ÿå¼‚æ­¥åŠ è½½
                setTimeout(() => {
                    for (let i = 0; i < 3; i++) {
                        const activityItem = generateActivityItem();
                        activitiesContainer.innerHTML += activityItem;
                    }
                    isLoading = false;
                }, 800);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å›¾è¡¨
            initFunctionUsageChart();
            initHeatmap();
            initAIChatChart();
            initContentEcosystemChart();
            
            // æ·»åŠ æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
            const dateRangeSelect = document.getElementById('dateRangeSelect');
            dateRangeSelect.addEventListener('change', function() {
                const range = parseInt(this.value);
                updateAllCharts(range);
            });
            
            // åˆå§‹åŒ–æ»šåŠ¨åŠ è½½åŠŸèƒ½
            initScrollLoad();
        });
    </script>
</body>
</html>
